<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Image → Text → Summary</title>
<style>
  :root{--bg:#0f172a;--panel:#111827;--muted:#94a3b8;--fg:#e5e7eb;--accent:#22d3ee}
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--fg);font:14px/1.45 system-ui,Segoe UI,Arial}
  .wrap{max-width:960px;margin:32px auto;padding:0 16px}
  h1{font-size:20px;margin:0 0 12px}
  .card{background:var(--panel);border-radius:12px;padding:16px;margin:12px 0}
  .row{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
  label{display:block;font-weight:600;margin:0 0 6px}
  input[type=text],textarea,select{width:100%;background:#0b1220;border:1px solid #1f2937;color:var(--fg);border-radius:8px;padding:10px}
  textarea{min-height:140px}
  button{background:var(--accent);color:#042c2c;border:0;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer}
  pre{white-space:pre-wrap;background:#0b1220;border:1px solid #1f2937;padding:12px;border-radius:8px;max-height:360px;overflow:auto}
  small{color:var(--muted)}
</style>
</head>
<body>
<div class="wrap">
  <h1>Image → Text → Summary</h1>

  <div class="card">
    <label>API Base URL</label>
    <input id="api" type="text" placeholder="https://YOUR-API.example.com" />
    <small>For local FastAPI use: <code>http://127.0.0.1:18080</code> (only works if this page is opened over http://). For Vercel, use an HTTPS URL (ngrok/cloudflared or your cloud host).</small>
    <div class="row" style="margin-top:8px">
      <button id="healthBtn">Recheck Health</button>
    </div>
    <pre id="healthOut">Click “Recheck Health”.</pre>
  </div>

  <div class="card">
    <h2 style="margin-top:0">Summarize Text</h2>
    <div class="row">
      <div style="flex:1;min-width:180px">
        <label>Format</label>
        <select id="fmt">
          <option value="plain">plain</option>
          <option value="bullets">bullets</option>
          <option value="markdown">markdown</option>
        </select>
      </div>
    </div>
    <label>Text</label>
    <textarea id="text" placeholder="Paste text to summarize..."></textarea>
    <div class="row" style="margin-top:8px">
      <button id="sumBtn">Summarize</button>
    </div>
    <pre id="sumOut"></pre>
  </div>

  <div class="card">
    <h2 style="margin-top:0">OCR</h2>
    <div class="row">
      <input id="file" type="file" accept="image/*,.pdf" />
      <button id="ocrBtn">OCR only</button>
      <button id="imgBtn">OCR + summarize</button>
      <select id="fmt2" title="Format for OCR+summary">
        <option value="plain">plain</option>
        <option value="bullets">bullets</option>
        <option value="markdown">markdown</option>
      </select>
    </div>
    <pre id="ocrOut"></pre>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const api = () => ($('api').value || '').replace(/\/+$/,'');

async function getJSON(url, opts){
  const r = await fetch(url, opts);
  const t = await r.text();
  let d = t; try{ d = JSON.parse(t);}catch{}
  if(!r.ok) throw new Error(typeof d === 'string' ? t : JSON.stringify(d));
  return d;
}

$('healthBtn').onclick = async () => {
  $('healthOut').textContent = 'Loading…';
  try{
    const d = await getJSON(`${api()}/health`);
    $('healthOut').textContent = JSON.stringify(d, null, 2);
  }catch(e){
    $('healthOut').textContent = 'Error: ' + e.message;
  }
};

$('sumBtn').onclick = async () => {
  $('sumOut').textContent = 'Loading…';
  try{
    const body = JSON.stringify({ text: $('text').value });
    const d = await getJSON(`${api()}/infer/text?fmt=${encodeURIComponent($('fmt').value)}`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body
    });
    $('sumOut').textContent = JSON.stringify(d, null, 2);
  }catch(e){
    $('sumOut').textContent = 'Error: ' + e.message;
  }
};

$('ocrBtn').onclick = async () => {
  $('ocrOut').textContent = 'Loading…';
  const f = $('file').files[0];
  if(!f){ $('ocrOut').textContent = 'Choose a file first.'; return; }
  const fd = new FormData(); fd.append('file', f);
  try{
    const d = await getJSON(`${api()}/infer/ocr`, { method:'POST', body:fd });
    $('ocrOut').textContent = JSON.stringify(d, null, 2);
  }catch(e){
    $('ocrOut').textContent = 'Error: ' + e.message;
  }
};

$('imgBtn').onclick = async () => {
  $('ocrOut').textContent = 'Loading…';
  const f = $('file').files[0];
  if(!f){ $('ocrOut').textContent = 'Choose a file first.'; return; }
  const fd = new FormData(); fd.append('file', f);
  try{
    const d = await getJSON(`${api()}/infer/image?fmt=${encodeURIComponent($('fmt2').value)}`, { method:'POST', body:fd });
    $('ocrOut').textContent = JSON.stringify(d, null, 2);
  }catch(e){
    $('ocrOut').textContent = 'Error: ' + e.message;
  }
};
</script>
</body>
</html>
